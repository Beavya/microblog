{% extends "layout/base.html" %}
{% load bootstrap4 %}
{% block title %}{{ post.title }}{% endblock %}
{% block content %}
<div class="card">
  <div class="card-header">
    <h2 class="h4 mb-0">{{ post.title }}</h2>
    <small class="text-muted">
      Автор: {{ post.author.username }} •
      {{ post.created_at|date:"d.m.Y H:i" }}
    </small>
  </div>
  <div class="card-body">
    <p>{{ post.content }}</p>

    {% if user.is_authenticated and user == post.author %}
      <div class="mt-3">
        <a href="{% url 'main:post_edit' post.pk %}" class="btn btn-sm btn-outline-primary">Редактировать</a>
        <a href="{% url 'main:post_delete' post.pk %}" class="btn btn-sm btn-outline-danger">Удалить</a>
      </div>
    {% endif %}

    {% if user.is_authenticated %}
      <form method="post" action="{% url 'main:like_post' post.pk %}" class="mt-2">
        {% csrf_token %}
        <button type="submit" class="btn {% if liked %}btn-danger{% else %}btn-outline-danger{% endif %}">❤️</button>
      </form>
    {% endif %}
  </div>

  <div class="card-footer text-muted">
    Комментариев: {{ post.comments.count }} • Лайков: {{ post.likes.count }}
  </div>
</div>
{% if comments %}
  <h4 class="mt-5">Комментарии ({{ comments|length }})</h4>
  {% for comment in comments %}
    <div class="card mb-2">
      <div class="card-body">
        <small class="text-muted">{{ comment.author.username }}, {{ comment.created_at|date:"d.m.Y H:i" }}</small>
        <p class="mb-0">{{ comment.content }}</p>
        {% if user.is_authenticated and user == comment.author %}
          <div class="mt-1">
            <a href="{% url 'main:comment_edit' comment.pk %}" class="btn btn-sm btn-outline-primary">Редактировать</a>
            <a href="{% url 'main:comment_delete' comment.pk %}" class="btn btn-sm btn-outline-danger">Удалить</a>
          </div>
        {% endif %}
      </div>
    </div>

  {% endfor %}
{% endif %}

{% if user.is_authenticated %}
  <h4 class="mt-5">Оставить комментарий</h4>
  <form method="post">
    {% csrf_token %}
    {% bootstrap_form form layout='horizontal' %}
    {% buttons submit='Отправить' %}{% endbuttons %}
  </form>
{% endif %}

<div class="mt-3">
  <a href="{% url 'main:index' %}" class="btn btn-outline-secondary">Назад к постам</a>
</div>
{% endblock %}